<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_move_form_inherit_account_payments_group" model="ir.ui.view">
        <field name="name">account.move.view.form.inherit</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form" />
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="open_payment_groups" class="oe_stat_button" icon="fa-list"
                    type="object">
                    <field name="payment_group_count" modifiers="{'readonly':true}" />
                </button>
            </xpath>
        </field>
    </record>
    <record id="account_payment_group_view_search" model="ir.ui.view">
        <field name="name">account.payment.group.view.search</field>
        <field name="model">account.payment.group</field>
        <field name="arch" type="xml">
            <search string="">
                <field name="name" />
                <field name="partner_id" />
                <field name="payments_total" />
                <field name="journal_ids" />
                <filter name="draft" string="Borrador" domain="[('state','=','draft')]" />
                <filter name="published" string="Publicado" domain="[('state','=','posted')]" />
                <filter name="canceled" string="Cancelado" domain="[('state','=','canceled')]" />
                <filter name="date" string="Fecha" date="date" />
                <filter name="groupby_date" string="Fecha" context="{'group_by': 'date'}" />
                <filter name="groupby_partner_id" string="Cliente" context="{'group_by': 'partner_id'}" />
            </search>
        </field>
    </record>
    <record id="account_payment_group_view_list" model="ir.ui.view">
        <field name="name">account.payment.group.view.list</field>
        <field name="model">account.payment.group</field>
        <field name="arch" type="xml">
            <list string="Recibos" decoration-danger="state=='canceled'" decoration-success="state=='posted'" decoration-muted="state=='draft'">
                <field name="date" />
                <field name="name" />
                <field name="partner_id" />
                <field name="payments_total" />
                <field name="journal_ids" widget="many2many_tags"/>
                <field name="state" widget="badge" decoration-danger="state=='canceled'" decoration-success="state=='posted'" decoration-muted="state=='draft'"/>
            </list>
        </field>
    </record>
<record id="account_payment_group_view_form" model="ir.ui.view">
    <field name="name">account.payment.group.view.form</field>
    <field name="model">account.payment.group</field>
    <field name="arch" type="xml">
        <form string="Grupo de pagos">
            <header>
                <button name="post" type="object" class="btn btn-primary" string="Publicar" invisible="state != 'draft'" />
                <button name="cancel" type="object" string="Cancelar" invisible="state != 'posted'" />
                <button name="to_draft" type="object" string="Restablecer a borrador" invisible="state != 'canceled'" />
                <field name="state" widget="statusbar" />
            </header>
            <sheet>
                <div class="oe_title">
                    <h1><field name="name" /></h1>
                </div>
                <group>
                    <group>
                        <field name="date" />
                        <field name="company_id" invisible="1" />
                        <field name="partner_id" />
                        <field name="currency_id" />
                    </group>
                    <group>
                        <field name="payment_difference_handling" widget="radio" />
                    </group>
                </group>
                <group invisible="payment_difference_handling != 'reconcile'">
                    <group>
                        <field name="writeoff_journal_id" />
                        <field name="writeoff_label" />
                    </group>
                    <group>
                        <field name="writeoff_account_id" />
                    </group>
                </group>
                <notebook>
                    <page name="payments" string="Pagos">
                        <field name="payment_type" invisible="1" />
                        <field name="payment_lines_ids"
                            domain="[('partner_id','=',partner_id)]"
                            context="{
                                'form_view_ref': 'account_payments_group.view_account_payment_form_inherit_account_payments_group',
                                'default_partner_id':partner_id, 
                                'default_currency_id':currency_id,
                                'default_payment_type':'inbound' if payment_type == 'receivable' else 'outbound',
                                'default_partner_type':'customer' if payment_type == 'receivable' else 'supplier'
                            }">
                            <list>
                                <field name="date" />
                                <field name="partner_id" groups="base.group_no_one" />
                                <field name="journal_id" />
                                <field name="amount" />
                                <field name="state" invisible="1" />
                            </list>
                        </field>
                        <group name="Totals">
                            <button name="action_add_withholdings_payments" type="object" string="Calcular retenciones" />
                            <group>
                                <field name="payments_total" />
                                <field name="matched_amount" />
                            </group>
                            <group>
                                <field name="unmatched_amount" />
                            </group>
                        </group>
                    </page>
                    <page name="moves" string="Comprobantes imputados">
                        <button name="remove_all_moves" type="object" string="Vaciar lista de comprobantes" />
                        <button name="add_all_unreconcilied_moves" type="object" string="Agregar comprobantes no imputados" />
                        <field name="move_line_ids" context="{'default_partner_id':partner_id}"
                            domain="[('partner_id','=',partner_id),('move_id.state','=','posted'),'|',('amount_residual','!=',0),('amount_residual_currency', '!=', 0.0),('account_id.reconcile', '=', True),('reconciled', '=', False)]">
                            <list>
                                <field name="name" string="Punto de emision" />
                                <field name="date" invisible="1" />
                                <field name="date_maturity" />
                                <field name="move_id" string="Comprobante" />
                                <field name="journal_id" string="Punto de emision" />
                                <field name="balance" />
                                <field name="amount_residual" sum="1" />
                                <field name="amount_currency" sum="1" />
                                <field name="amount_residual_currency" sum="1" />
                            </list>
                        </field>
                    </page>
                    <page string="Otra informaciÃ³n">
                        <group>
                            <field name="observations" />
                        </group>
                    </page>
                </notebook>
            </sheet>
            <chatter/>
        </form>
    </field>
</record>


    <record id="view_account_payment_form_inherit_account_payments_group" model="ir.ui.view">
        <field name="name">account.payment.view.form.inherit</field>
        <field name="model">account.payment</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="arch" type="xml">
            <header position="replace">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="draft,posted"/>
                </header>
            </header>
            <field name="payment_type" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
        </field>
    </record>

</odoo>
