<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="account_payment_group_view_form" model="ir.ui.view">
        <field name="name">account.payment.group.view.form</field>
        <field name="model">account.payment.group</field>
        <field name="arch" type="xml">
            <form string="Grupo de pagos">
                <header>
                    <button name="post" type="object" class="btn btn-primary" string="Publicar" states='draft'/>
                    <button name="cancel" type="object" string="Cancelar" states='posted'/>
                    <button name="to_draft" type="object" string="Restablecer a borrador" states='canceled'/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe-title">
                        <field name="name" />
                    </div>
                    <group>
                        <group>
                            <field name="date" />
                            <field name="company_id" invisible="1"/>
                            <field name="partner_id" />
                        </group>
                        <group>
                            <field name="observations" />
                        </group>
                        <group>
                            <field name="payments_total" />
                            <field name="matched_amount" />
                            <field name="unmatched_amount" />
                        </group>
                    </group>
                    <notebook>
                        <page name="payments" string="Pagos">

                            <field name="payment_lines_ids" context="{
                                            'default_partner_id':partner_id,
                                            'default_payment_type':'inbound',
                                            'default_amount':unmatched_amount,
                                            }" 
                                            domain="[('partner_id','=',partner_id)]">
                                <tree>
                                    <field name="payment_date" />
                                    <field name="partner_id" />
                                    <field name="amount" />
                                    <field name="communication" />
                                    <field name="state" invisible="1"/>
                                </tree>
                            </field>
                        </page>
                        <page name="moves" string="Comprobantes imputados">
                            <field name="move_line_ids" context="{'default_partner_id':partner_id}" domain="[('partner_id','=',partner_id),('move_id.state','=','posted'),'|',('amount_residual','!=',0),('amount_residual_currency', '!=', 0.0),('account_id.reconcile', '=', True),('reconciled', '=', False)]">
                                <tree  >
                                    <field name="name" string="Punto de emision"/>
                                    <field name="date" invisible="1"/>
                                    <field name="date_maturity" />
                                    <field name="move_id" string="Comprobante"/>
                                    <field name="journal_id" string="Punto de emision"/>
                                    <field name="balance" />
                                    <field name="amount_residual" sum="1"/>
                                    <field name="amount_currency" sum="1"/>
                                    <field name="amount_residual_currency" sum="1"/>
                                </tree>
                            </field>
                            <button name="add_all_unreconcilied_moves" type="object" string="Agregar comprobantes no imputados"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

</odoo>
